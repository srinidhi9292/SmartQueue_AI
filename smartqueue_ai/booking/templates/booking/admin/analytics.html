{% extends 'booking/base.html' %}
{% block title %}Analytics{% endblock %}
{% block extra_css %}<style>
.admin-layout{display:flex;min-height:calc(100vh - 67px)}.main-content{flex:1;padding:36px}
.main-content h1,.main-content h2,.main-content h3,.main-content h4,.main-content h5,.main-content h6 { color:#e8eeff !important; }
.card h6,.card h5,.card h4 { color:#e8eeff !important; }
.table td { color:#e8eeff !important; }
.table th,.table-light th { color:#8fa8cc !important; }
.table-light { background:rgba(15,22,41,0.7) !important; }
.btn-outline-primary { color:#5b8fff !important; }
.btn-outline-danger  { color:#ff4d6d !important; }
</style>{% endblock %}
{% block content %}
<div class="admin-layout" style="position:relative;z-index:1">
<div class="admin-sidebar">
    <div class="px-4 mb-4"><div style="font-size:.7rem;text-transform:uppercase;letter-spacing:2px;color:var(--muted)">Admin Panel</div></div>
    <nav class="nav flex-column gap-1">
        <a class="nav-link" href="{% url 'admin_dashboard' %}"><i class="bi bi-speedometer2"></i>Dashboard</a>
        <a class="nav-link" href="{% url 'admin_appointments' %}"><i class="bi bi-calendar-check"></i>Appointments</a>
        <a class="nav-link" href="{% url 'admin_services' %}"><i class="bi bi-grid-3x3-gap"></i>Services</a>
        <a class="nav-link" href="{% url 'admin_timeslots' %}"><i class="bi bi-clock"></i>Time Slots</a>
        <a class="nav-link" href="{% url 'admin_blocked_dates' %}"><i class="bi bi-calendar-x"></i>Blocked Dates</a>
        <a class="nav-link active" href="{% url 'admin_analytics' %}"><i class="bi bi-graph-up"></i>Analytics</a>
        <div style="height:1px;background:var(--border);margin:12px 16px"></div>
        <a class="nav-link" href="{% url 'home' %}"><i class="bi bi-house"></i>Public Site</a>
    </nav>
</div>
<div class="main-content">
    <div class="mb-5">
        <span class="section-label mb-2 d-inline-flex">Insights</span>
        <h3 style="font-family:'Syne',sans-serif;font-weight:800;margin:0">Detailed Analytics</h3>
    </div>
    <div class="row g-4 mb-4">
        <div class="col-md-7">
            <div class="card p-4 h-100">
                <div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--primary),var(--violet));border-radius:20px 20px 0 0"></div>
                <h6 style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:20px">Monthly Bookings â€” 12 Months</h6>
                <canvas id="monthlyChart" height="120"></canvas>
            </div>
        </div>
        <div class="col-md-5">
            <div class="card p-4 h-100">
                <div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--emerald),var(--cyan));border-radius:20px 20px 0 0"></div>
                <h6 style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:20px">Top Services</h6>
                <table class="table table-hover align-middle">
                    <thead class="table-light"><tr><th>Service</th><th>Count</th><th>Share</th></tr></thead>
                    <tbody>
                        {% for s in service_stats %}
                        <tr>
                            <td style="font-weight:600;font-size:.9rem">{{ s.service__name }}</td>
                            <td style="color:var(--emerald);font-weight:700">{{ s.count }}</td>
                            <td>
                                <div class="progress" style="height:6px;width:80px">
                                    <div class="progress-bar" style="width:{% if total_bookings %}{% widthratio s.count total_bookings 100 %}{% else %}0{% endif %}%"></div>
                                </div>
                            </td>
                        </tr>
                        {% empty %}<tr><td colspan="3" style="color:var(--muted)">No data yet.</td></tr>{% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
Chart.defaults.font.family = "'DM Sans', sans-serif";
Chart.defaults.color = '#6b7db3';
new Chart(document.getElementById('monthlyChart'), {
    type: 'line',
    data: {
        labels: {{ monthly_labels|safe }},
        datasets: [{
            label: 'Bookings',
            data: {{ monthly_counts|safe }},
            borderColor: '#5b8fff',
            backgroundColor: 'rgba(91,143,255,0.1)',
            fill: true, tension: 0.45,
            pointBackgroundColor: '#5b8fff', pointRadius: 5,
        }]
    },
    options: {
        plugins: { legend: { display: false } },
        scales: {
            y: { beginAtZero: true, grid: { color: 'rgba(99,130,255,0.06)' }, border: { display: false } },
            x: { grid: { display: false }, border: { display: false } }
        }
    }
});
</script>
{% endblock %}
